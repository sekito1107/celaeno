import { Controller } from "@hotwired/stimulus"

export default class extends Controller {
  static targets = ["text"]

  connect() {
    this.quotes = [
      "ビヤーキーに乗る際は、黄金の蜂蜜酒を忘れてはならない。",
      "ふんぐるい むぐるうなふ くとぅるう るるいえ うがふなぐる ふたぐん",
      "深淵を覗くとき、深淵もまたこちらを覗いているのだ。",
      "恐怖こそが、最も古く、最も強い感情である。",
      "その死せるものは、永遠に横たわることなし。",
      "名状しがたきものが、そこに居た。",
      "いあ！ いあ！ はすたあ！",
      "窓に！ 窓に！",
      "テケリ・リ！ テケリ・リ！",
      "もはや、逃げる場所など何処にもない。",
      "星辰が正しい位置についたとき、彼らは蘇るだろう。",
      "我々はただ、その時を待つのみ。",
      "狂気だけが、唯一の救済となるかもしれない。",
      "古代の神々は、死んではいない。ただ眠っているだけだ。",
      "その書物を開いてはならない。そこには禁断の知識が記されている。",
      "インスマスには近づくな。あそこの住人は何かがおかしい。",
      "壁の中から音が聞こえる… ネズミではない、もっと大きな何かが…",
      "銀の鍵が、幻夢境への扉を開く。",
      "ニャルラトホテプ… 這い寄る混沌…",
      "サツァ… ヨグ・ソトース…",
      "この宇宙において、人類はあまりにも無力な存在に過ぎない。",
      "正気を保つためには、見ざる、聞かざる、知らざるが一番だ。",
      "世界で最も慈悲深いことは、人間の心が自らの内容を相互に関連づけられないことだと思う。",
      "無限の黒い海に囲まれた、無知という名の穏やかな島に我々は住んでいる。",
      "ヨグ＝ソトースは門を知っている。ヨグ＝ソトースは門である。ヨグ＝ソトースは門の鍵であり、守護者である。",
      "それは色ではなかった。ただ、強いて言うならば、既存の色彩の範疇を超えた不気味な輝きだった。",
      "死せるクトゥルフが、ルルイエの館で夢見ながら待っている。",
      "音もなく、それは這い寄ってくる。影よりも暗く、夜よりも深い場所から。",
      "幾何学的にありえない角度。この場所の造形は、人間が理解できる理を超えている。",
      "彼らはかつて居た。彼らは今も居る。そして彼らは、これからも居るだろう。",
      "空を見上げてはならない。星々が不吉な配列をとり始めている。",
      "ただの幻覚だと言ってくれ。あの魚のような眼をした男たちが、私を追ってこないと言ってくれ。",
      "深きものどもの歌が、潮騒に混じって聞こえてくる…。",
      "それは生命の形をしていなかった。むしろ、生命を冒涜するために形を与えられた何かのようだった。",
      "神々に慈悲を乞うな。彼らにとって、我々は足元の蟻に等しい存在なのだから。",
      "知識は、時に呪いとなる。知らないままでいられたなら、どれほど幸せだっただろうか。",
      "ルルイエ！ ルルイエ！ クトゥルフ・フタグン！",
      "退散させる方法を知らぬものを、呼び出してはならない。",
      "暗黒の宇宙が口を開け、名もなき恐怖がそこから溢れ出している。",
      "人間の論理など、広大な宇宙の狂気の前では砂粒にも等しい。",
      "いあ！ しゅぶ＝にぐらす！ 千の仔を孕みし森の黒山羊よ！",
      "彼らは星々の間からやってきた。そして、再び戻ってくるだろう。",
      "その音を聞いてはならない。それは、理性を粉砕する調べなのだから。",
      "古い儀式を軽んじてはならない。血の契約は、今も有効なのだ。",
      "夢の中で、私はあの忌まわしい都市を見た。非ユークリッド幾何学の尖塔を。",
      "死すらも、時とともに死に絶えることがあるのだ。",
      "クトゥルフ・フタグン！ 夢見る主よ、我らの声を聞き届けたまえ。",
      "そこには光はなく、ただ凍てつくような暗黒と、粘着質な気配だけがあった。",
      "お前が読んでいるのは、かつて人を狂わせた魔道書の断片かもしれない。",
      "それは、人間の言葉では表現できないほどに、悍ましく、歪んでいた。",
      "かつての支配者たちは、今も地下深くで、鼓動を刻み続けている。",
      "目を開けてはならない。現実を直視すれば、お前の精神は崩壊するだろう。",
      "冷たき荒野の果て、カダスに向かった者は、誰一人として戻らなかった。",
      "アザトース、中心で沸き立つ混沌… 万物の王にして、盲目なる神。",
      "我々は、自らが生み出した科学という光で、覗いてはならない闇を照らしてしまった。",
      "それは影ではなく、実体を持った絶望だった。",
      "真実を知ることは、必ずしも幸福をもたらすとは限らない。"
    ]
    // Randomize start index
    this.currentIndex = Math.floor(Math.random() * this.quotes.length)
    this.textTarget.textContent = this.quotes[this.currentIndex] // Initial text update to random
    
    this.startRotation()
  }

  disconnect() {
    if (this.timer) clearInterval(this.timer)
    if (this.fadeTimeout) clearTimeout(this.fadeTimeout)
  }

  startRotation() {
    this.timer = setInterval(() => {
      this.cycleText()
    }, 9000) // 9 seconds interval (3x original)
  }

  cycleText() {
    // Fade out
    this.textTarget.style.opacity = 0
    
    this.fadeTimeout = setTimeout(() => {
      if (!this.element.isConnected) return

      // Pick random next quote instead of sequential to keep it fresh
      let nextIndex
      do {
        nextIndex = Math.floor(Math.random() * this.quotes.length)
      } while (nextIndex === this.currentIndex && this.quotes.length > 1)
      
      this.currentIndex = nextIndex
      this.textTarget.textContent = this.quotes[this.currentIndex]
      // Fade in
      this.textTarget.style.opacity = 1
    }, 1000) // 1 second fade out/in (slower, more atmospheric)
  }
}
